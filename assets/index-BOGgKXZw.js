(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))d(u);new MutationObserver(u=>{for(const l of u)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function r(u){const l={};return u.integrity&&(l.integrity=u.integrity),u.referrerPolicy&&(l.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?l.credentials="include":u.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(u){if(u.ep)return;u.ep=!0;const l=r(u);fetch(u.href,l)}})();function Xe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ce(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var s=t.default;if(typeof s=="function"){var r=function d(){var u=!1;try{u=this instanceof d}catch{}return u?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};r.prototype=s.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(d){var u=Object.getOwnPropertyDescriptor(t,d);Object.defineProperty(r,d,u.get?u:{enumerable:!0,get:function(){return t[d]}})}),r}var Z={exports:{}},je=Z.exports,pe;function Be(){return pe||(pe=1,(function(t){(function(s,r,d){function u(e){var o=this,a=c();o.next=function(){var n=2091639*o.s0+o.c*23283064365386963e-26;return o.s0=o.s1,o.s1=o.s2,o.s2=n-(o.c=n|0)},o.c=1,o.s0=a(" "),o.s1=a(" "),o.s2=a(" "),o.s0-=a(e),o.s0<0&&(o.s0+=1),o.s1-=a(e),o.s1<0&&(o.s1+=1),o.s2-=a(e),o.s2<0&&(o.s2+=1),a=null}function l(e,o){return o.c=e.c,o.s0=e.s0,o.s1=e.s1,o.s2=e.s2,o}function x(e,o){var a=new u(e),n=o&&o.state,i=a.next;return i.int32=function(){return a.next()*4294967296|0},i.double=function(){return i()+(i()*2097152|0)*11102230246251565e-32},i.quick=i,n&&(typeof n=="object"&&l(n,a),i.state=function(){return l(a,{})}),i}function c(){var e=4022871197,o=function(a){a=String(a);for(var n=0;n<a.length;n++){e+=a.charCodeAt(n);var i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=i*4294967296}return(e>>>0)*23283064365386963e-26};return o}r&&r.exports?r.exports=x:this.alea=x})(je,t)})(Z)),Z.exports}var Y={exports:{}},$e=Y.exports,ge;function De(){return ge||(ge=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var n=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^n^n>>>8},c===(c|0)?e.x=c:o+=c;for(var a=0;a<o.length+64;a++)e.x^=o.charCodeAt(a)|0,e.next()}function l(c,e){return e.x=c.x,e.y=c.y,e.z=c.z,e.w=c.w,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xor128=x})($e,t)})(Y)),Y.exports}var J={exports:{}},Ge=J.exports,ve;function Ue(){return ve||(ve=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.next=function(){var n=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(n^n<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,c===(c|0)?e.x=c:o+=c;for(var a=0;a<o.length+64;a++)e.x^=o.charCodeAt(a)|0,a==o.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function l(c,e){return e.x=c.x,e.y=c.y,e.z=c.z,e.w=c.w,e.v=c.v,e.d=c.d,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xorwow=x})(Ge,t)})(J)),J.exports}var Q={exports:{}},ze=Q.exports,me;function Le(){return me||(me=1,(function(t){(function(s,r,d){function u(c){var e=this;e.next=function(){var a=e.x,n=e.i,i,f;return i=a[n],i^=i>>>7,f=i^i<<24,i=a[n+1&7],f^=i^i>>>10,i=a[n+3&7],f^=i^i>>>3,i=a[n+4&7],f^=i^i<<7,i=a[n+7&7],i=i^i<<13,f^=i^i<<9,a[n]=f,e.i=n+1&7,f};function o(a,n){var i,f=[];if(n===(n|0))f[0]=n;else for(n=""+n,i=0;i<n.length;++i)f[i&7]=f[i&7]<<15^n.charCodeAt(i)+f[i+1&7]<<13;for(;f.length<8;)f.push(0);for(i=0;i<8&&f[i]===0;++i);for(i==8?f[7]=-1:f[i],a.x=f,a.i=0,i=256;i>0;--i)a.next()}o(e,c)}function l(c,e){return e.x=c.x.slice(),e.i=c.i,e}function x(c,e){c==null&&(c=+new Date);var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(a.x&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xorshift7=x})(ze,t)})(Q)),Q.exports}var ee={exports:{}},ke=ee.exports,he;function Ve(){return he||(he=1,(function(t){(function(s,r,d){function u(c){var e=this;e.next=function(){var a=e.w,n=e.X,i=e.i,f,y;return e.w=a=a+1640531527|0,y=n[i+34&127],f=n[i=i+1&127],y^=y<<13,f^=f<<17,y^=y>>>15,f^=f>>>12,y=n[i]=y^f,e.i=i,y+(a^a>>>16)|0};function o(a,n){var i,f,y,S,T,_=[],L=128;for(n===(n|0)?(f=n,n=null):(n=n+"\0",f=0,L=Math.max(L,n.length)),y=0,S=-32;S<L;++S)n&&(f^=n.charCodeAt((S+32)%n.length)),S===0&&(T=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,S>=0&&(T=T+1640531527|0,i=_[S&127]^=f+T,y=i==0?y+1:0);for(y>=128&&(_[(n&&n.length||0)&127]=-1),y=127,S=512;S>0;--S)f=_[y+34&127],i=_[y=y+1&127],f^=f<<13,i^=i<<17,f^=f>>>15,i^=i>>>12,_[y]=f^i;a.w=T,a.X=_,a.i=y}o(e,c)}function l(c,e){return e.i=c.i,e.w=c.w,e.X=c.X.slice(),e}function x(c,e){c==null&&(c=+new Date);var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(a.X&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xor4096=x})(ke,t)})(ee)),ee.exports}var te={exports:{}},We=te.exports,we;function Fe(){return we||(we=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.next=function(){var n=e.b,i=e.c,f=e.d,y=e.a;return n=n<<25^n>>>7^i,i=i-f|0,f=f<<24^f>>>8^y,y=y-n|0,e.b=n=n<<20^n>>>12^i,e.c=i=i-f|0,e.d=f<<16^i>>>16^y,e.a=y-n|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,c===Math.floor(c)?(e.a=c/4294967296|0,e.b=c|0):o+=c;for(var a=0;a<o.length+20;a++)e.b^=o.charCodeAt(a)|0,e.next()}function l(c,e){return e.a=c.a,e.b=c.b,e.c=c.c,e.d=c.d,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.tychei=x})(We,t)})(te)),te.exports}var ne={exports:{}};const Ke={},He=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"})),Ze=Ce(He);var Ye=ne.exports,be;function Je(){return be||(be=1,(function(t){(function(s,r,d){var u=256,l=6,x=52,c="random",e=d.pow(u,l),o=d.pow(2,x),a=o*2,n=u-1,i;function f(p,g,w){var m=[];g=g==!0?{entropy:!0}:g||{};var v=_(T(g.entropy?[p,k(r)]:p??L(),3),m),M=new y(m),N=function(){for(var E=M.g(l),P=e,O=0;E<o;)E=(E+O)*u,P*=u,O=M.g(1);for(;E>=a;)E/=2,P/=2,O>>>=1;return(E+O)/P};return N.int32=function(){return M.g(4)|0},N.quick=function(){return M.g(4)/4294967296},N.double=N,_(k(M.S),r),(g.pass||w||function(E,P,O,X){return X&&(X.S&&S(X,M),E.state=function(){return S(M,{})}),O?(d[c]=E,P):E})(N,v,"global"in g?g.global:this==d,g.state)}function y(p){var g,w=p.length,m=this,v=0,M=m.i=m.j=0,N=m.S=[];for(w||(p=[w++]);v<u;)N[v]=v++;for(v=0;v<u;v++)N[v]=N[M=n&M+p[v%w]+(g=N[v])],N[M]=g;(m.g=function(E){for(var P,O=0,X=m.i,F=m.j,V=m.S;E--;)P=V[X=n&X+1],O=O*u+V[n&(V[X]=V[F=n&F+P])+(V[F]=P)];return m.i=X,m.j=F,O})(u)}function S(p,g){return g.i=p.i,g.j=p.j,g.S=p.S.slice(),g}function T(p,g){var w=[],m=typeof p,v;if(g&&m=="object")for(v in p)try{w.push(T(p[v],g-1))}catch{}return w.length?w:m=="string"?p:p+"\0"}function _(p,g){for(var w=p+"",m,v=0;v<w.length;)g[n&v]=n&(m^=g[n&v]*19)+w.charCodeAt(v++);return k(g)}function L(){try{var p;return i&&(p=i.randomBytes)?p=p(u):(p=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(p)),k(p)}catch{var g=s.navigator,w=g&&g.plugins;return[+new Date,s,w,s.screen,k(r)]}}function k(p){return String.fromCharCode.apply(0,p)}if(_(d.random(),r),t.exports){t.exports=f;try{i=Ze}catch{}}else d["seed"+c]=f})(typeof self<"u"?self:Ye,[],Math)})(ne)),ne.exports}var se,Se;function Qe(){if(Se)return se;Se=1;var t=Be(),s=De(),r=Ue(),d=Le(),u=Ve(),l=Fe(),x=Je();return x.alea=t,x.xor128=s,x.xorwow=r,x.xorshift7=d,x.xor4096=u,x.tychei=l,se=x,se}var et=Qe();const tt=Xe(et),Oe=1400,qe=1e3,nt="/src/assets/player.png",G={floor:"#1a1a1a",wall:"#2f2f2f",start:"#22d3ee",exit:"#f59e0b",player:"#4ade80",hud:"#9ca3af"};function rt(t,s){const r=Math.ceil(s),d=String(Math.floor(r/60)).padStart(2,"0"),u=String(r%60).padStart(2,"0");t.fillStyle=r<=10?"#ff5252":G.hud,t.font="20px 'Press Start 2P'",t.fillText(`${d}:${u}`,12,24)}function Me(t,s){t.save(),t.fillStyle="#000a",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="#fff",t.font="28px 'Press Start 2P'";const r=t.measureText(s).width;t.fillText(s,(t.canvas.width-r)/2,t.canvas.height/2),t.restore()}function ot(t,s,r){t%2===0&&(t-=1),s%2===0&&(s-=1),t=Math.max(11,t),s=Math.max(11,s);const d=Array.from({length:s},()=>Array(t).fill(1)),u={x:1,y:1};d[u.y][u.x]=0;const l=[];for(c(u.x,u.y);l.length;){const e=Math.floor(r()*l.length),{x:o,y:a}=l.splice(e,1)[0],n=Ee(o,a,t,s).filter(i=>d[i.y][i.x]===0);if(n.length){const i=n[Math.floor(r()*n.length)],f=Math.floor((o+i.x)/2),y=Math.floor((a+i.y)/2);d[y][f]=0,d[a][o]=0,c(o,a)}}const x={x:t-2,y:s-2};return d[x.y][x.x]=0,{grid:d,w:t,h:s,start:u,exit:x};function c(e,o){for(const a of Ee(e,o,t,s))d[a.y][a.x]===1&&!l.some(n=>n.x===a.x&&n.y===a.y)&&l.push({x:a.x,y:a.y})}}function it(t,s,r){const{grid:d,w:u,h:l,start:x,exit:c}=s;t.fillStyle=G.floor,t.fillRect(0,0,u*r,l*r),t.strokeStyle="rgba(255, 255, 255, 0.26)",t.lineWidth=1;for(let e=0;e<l;e++)for(let o=0;o<u;o++)t.strokeRect(o*r,e*r,r,r);t.fillStyle=G.wall;for(let e=0;e<l;e++)for(let o=0;o<u;o++)d[e][o]===1&&t.fillRect(o*r,e*r,r,r);t.fillStyle=G.start,t.fillRect(x.x*r,x.y*r,r,r),t.fillStyle=G.exit,t.fillRect(c.x*r,c.y*r,r,r)}function Ee(t,s,r,d){const u=[];return t-2>0&&u.push({x:t-2,y:s}),t+2<r-1&&u.push({x:t+2,y:s}),s-2>0&&u.push({x:t,y:s-2}),s+2<d-1&&u.push({x:t,y:s+2}),u}function st(t,s,r){return{dir:1,gx:t,gy:s,x:t*r,y:s*r,size:r}}function Ie(t,s,r,d,u){const l=t.gx+r,x=t.gy+d;return r>0&&(t.dir=1),r<0&&(t.dir=-1),l>=0&&l<s.w&&x>=0&&x<s.h&&s.grid[x][l]!==1?(t.gx=l,t.gy=x,t.x=t.gx*u,t.y=t.gy*u,!0):!1}function at(t,s,r){const d=ut(),u=Math.round(s.x),l=Math.round(s.y);t.save(),t.translate(u+r/2,l+r/2),t.scale(s.dir,1),d&&d.complete?t.drawImage(d,-r/2,-r/2,r,r):(t.fillStyle=G.player,t.fillRect(-s.size/2,-s.size/2,s.size,s.size)),t.restore()}function ut(){if(!window._playerImg){const t=new Image;t.src=nt,window._playerImg=t}return window._playerImg}function ct(t,s){let r=t,d=!1,u=t;return{start(){d=!0},stop(){d=!1},pause(){d=!1},resume(){d=!0},update(l){d&&(r=Math.max(0,r-l),Math.floor(u)!==Math.floor(r)&&s?.(),u=r)},remaining(){return r},max:t}}const I={};let ue=.4;function K(t,s){const r=new Audio(s);r.volume=ue,I[t]=r}function ft(){K("tick","/src/assets/audios/tick.wav"),K("move","/src/assets/audios/move.wav"),K("bump","/src/assets/audios/bump.wav"),K("win","/src/assets/audios/win.wav")}function B(t){I[t]&&(I[t].load(),I[t].currentTime=0,I[t].play().catch(s=>{console.error(`Failed to play sound: ${t}`,s)}))}function lt(t){I[t]&&(I[t].pause(),I[t].currentTime=0)}function dt(t){ue=t;for(const s in I)I[s].volume=ue}const oe=document.getElementById("app"),$=oe.getContext("2d");$.imageSmoothingEnabled=!1;oe.width=Oe;oe.height=qe;ft();const ie=document.getElementById("main-menu"),xt=document.getElementById("play-btn"),yt=document.getElementById("settings-btn"),pt=document.getElementById("exit-btn"),de=document.getElementById("settings-menu"),ae=document.getElementById("movement-toggle-btn"),gt=document.getElementById("volume-slider"),vt=document.getElementById("volume-label"),mt=document.getElementById("back-btn"),Pe=document.getElementById("tutorial"),xe=document.getElementById("game-info"),ce=32,fe=60,ht=5,wt=2;let z="autorun",q,j,A,U,Re,re=!1,D=1,R=ce,H=fe,b="MENU";const bt=150;let le=0,C={dx:0,dy:0},h={dx:0,dy:0},W;function ye(t,s=!1){s?(D++,R=Math.max(8,ce-(D-1)*wt),H=Math.max(10,fe-(D-1)*ht)):(D=1,R=ce,H=fe),U=t??Date.now().toString(),Re=tt(U);const r=Math.floor(Oe/R),d=Math.floor(qe/R);q=ot(r,d,Re),j=st(q.start.x,q.start.y,R),b="RUNNING",A&&A.stop(),A=ct(H,()=>B("tick")),re=!1,le=0,C={dx:0,dy:0},h={dx:0,dy:0},console.log("Game started, seed:",U,"Level:",D,"Tile Size:",R,"Time Limit:",H);const u=new URL(location);u.searchParams.set("seed",U),history.pushState({},"",u),W=performance.now()}xt.addEventListener("click",()=>{ie.style.display="none",app.style.display="block",Pe.style.display="block",xe.style.display="block";const t=new URLSearchParams(location.search);ye(t.get("seed")),b==="RUNNING"&&requestAnimationFrame(Te)});yt.addEventListener("click",()=>{ie.style.display="none",de.style.display="block"});pt.addEventListener("click",()=>{window.close()});ae.addEventListener("click",()=>{z==="manual"?(z="autorun",ae.textContent="Movement: Auto-run"):(z="manual",ae.textContent="Movement: Manual")});gt.addEventListener("input",t=>{const s=t.target.value;dt(s),vt.textContent=`${Math.round(s*100)}%`});mt.addEventListener("click",()=>{de.style.display="none",ie.style.display="block"});addEventListener("keydown",t=>{if(t.code==="KeyR"){Ae();return}if(t.code==="KeyM"){_e();return}if(b==="WON"||b==="LOST"){t.code==="Enter"?(console.debug("restarting"),b==="WON"?ye(null,!0):Ae()):t.code==="KeyM"&&(console.debug("Returning to main menu"),_e());return}if(b==="RUNNING"){let s=0,r=0;(t.code==="ArrowUp"||t.code==="KeyW")&&(r=-1),(t.code==="ArrowDown"||t.code==="KeyS")&&(r=1),(t.code==="ArrowLeft"||t.code==="KeyA")&&(s=-1),(t.code==="ArrowRight"||t.code==="KeyD")&&(s=1),(s!==0||r!==0)&&(re||(A.start(),re=!0),z==="manual"?Ie(j,q,s,r,R)?B("move"):B("bump"):z==="autorun"&&(C={dx:s,dy:r},h.dx===0&&h.dy===0&&(h={...C})))}});function St(t,s){Ie(j,q,t,s,R)?B("move"):B("bump")}function Te(t){W===void 0&&(W=t);const s=(t-W)/1e3;if(W=t,b==="RUNNING"){if(z==="autorun"&&(h.dx!==0||h.dy!==0)&&t-le>bt){le=t;const{gx:u,gy:l}=j;let x={...h};Ne(q,u,l,C.dx,C.dy)&&(C.dx!==h.dx||C.dy!==h.dy)?x={...C}:Ne(q,u,l,h.dx,h.dy)||(x={dx:0,dy:0}),h={...x},h.dx!==0||h.dy!==0?St(h.dx,h.dy):B("bump")}const r=Math.floor(j.x/R),d=Math.floor(j.y/R);r===q.exit.x&&d===q.exit.y?(b="WON",B("win"),console.debug("playsfx win"),A.stop(),console.log("Game state: WON")):(A.update(s),A.remaining()<=0&&(b="LOST",A.stop(),console.log("Game state: LOST")))}b!=="MENU"&&(it($,q,R),at($,j,R),rt($,A.remaining()),xe.innerText=`SEED=${U} LEVEL=${D}`),b==="WON"&&Me($,"YOU WIN — ENTER TO NEXT LEVEL | M FOR MENU"),b==="LOST"&&Me($,"TIME OUT — ENTER TO RESTART | M FOR MENU"),b!=="MENU"&&requestAnimationFrame(Te)}function Ne(t,s,r,d,u){const l=s+d,x=r+u;return l>=0&&l<t.w&&x>=0&&x<t.h&&t.grid[x][l]!==1}function Ae(t=!1){console.log("Restarting game");const s=t?U:Date.now().toString();ye(s)}function _e(){ie.style.display="block",de.style.display="none",app.style.display="none",Pe.style.display="none",xe.style.display="none",re=!1,lt("win"),oe.style.display="none",b="MENU",A&&A.stop(),console.log("Returning to main menu")}

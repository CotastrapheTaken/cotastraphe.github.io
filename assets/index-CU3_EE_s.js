(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const H=1400,j=1e3,w={floor:"#1a1a1a",wall:"#2f2f2f",start:"#22d3ee",exit:"#f59e0b",player:"#4ade80",hud:"#9ca3af"};function ee(e,t){const n=Math.ceil(t),s=String(Math.floor(n/60)).padStart(2,"0"),o=String(n%60).padStart(2,"0");e.fillStyle=n<=10?"#ff5252":w.hud,e.font="20px 'Press Start 2P'",e.fillText(`${s}:${o}`,12,24)}function L(e,t){e.save(),e.fillStyle="#000a",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#fff",e.font="28px 'Press Start 2P'";const n=e.measureText(t).width;e.fillText(t,(e.canvas.width-n)/2,e.canvas.height/2),e.restore()}function te(e,t,n){e%2===0&&(e-=1),t%2===0&&(t-=1),e=Math.max(11,e),t=Math.max(11,t);const s=Array.from({length:t},()=>Array(e).fill(1)),o={x:1,y:1};s[o.y][o.x]=0;const i=[];for(h(o.x,o.y);i.length;){const f=Math.floor(n()*i.length),{x:a,y:u}=i.splice(f,1)[0],x=W(a,u,e,t).filter(I=>s[I.y][I.x]===0);if(x.length){const I=x[Math.floor(n()*x.length)],_=Math.floor((a+I.x)/2),$=Math.floor((u+I.y)/2);s[$][_]=0,s[u][a]=0,h(a,u)}}const l={x:e-2,y:t-2};return s[l.y][l.x]=0,{grid:s,w:e,h:t,start:o,exit:l};function h(f,a){for(const u of W(f,a,e,t))s[u.y][u.x]===1&&!i.some(x=>x.x===u.x&&x.y===u.y)&&i.push({x:u.x,y:u.y})}}function ne(e,t,n){const{grid:s,w:o,h:i,start:l,exit:h}=t;e.fillStyle=w.floor,e.fillRect(0,0,o*n,i*n),e.strokeStyle="rgba(255, 255, 255, 0.26)",e.lineWidth=1;for(let f=0;f<i;f++)for(let a=0;a<o;a++)e.strokeRect(a*n,f*n,n,n);e.fillStyle=w.wall;for(let f=0;f<i;f++)for(let a=0;a<o;a++)s[f][a]===1&&e.fillRect(a*n,f*n,n,n);e.fillStyle=w.start,e.fillRect(l.x*n,l.y*n,n,n),e.fillStyle=w.exit,e.fillRect(h.x*n,h.y*n,n,n)}function W(e,t,n,s){const o=[];return e-2>0&&o.push({x:e-2,y:t}),e+2<n-1&&o.push({x:e+2,y:t}),t-2>0&&o.push({x:e,y:t-2}),t+2<s-1&&o.push({x:e,y:t+2}),o}const oe="data:image/png;base64,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";function ie(e,t,n){return{dir:1,gx:e,gy:t,x:e*n,y:t*n,size:n}}function q(e,t,n,s,o){const i=e.gx+n,l=e.gy+s;return n>0&&(e.dir=1),n<0&&(e.dir=-1),i>=0&&i<t.w&&l>=0&&l<t.h&&t.grid[l][i]!==1?(e.gx=i,e.gy=l,e.x=e.gx*o,e.y=e.gy*o,!0):!1}function se(e,t,n){const s=le(),o=Math.round(t.x),i=Math.round(t.y);e.save(),e.translate(o+n/2,i+n/2),e.scale(t.dir,1),s&&s.complete?e.drawImage(s,-n/2,-n/2,n,n):(e.fillStyle=w.player,e.fillRect(-t.size/2,-t.size/2,t.size,t.size)),e.restore()}function le(){if(!window._playerImg){const e=new Image;e.src=oe,window._playerImg=e}return window._playerImg}function re(e,t){let n=e,s=!1,o=e;return{start(){s=!0},stop(){s=!1},pause(){s=!1},resume(){s=!0},update(i){s&&(n=Math.max(0,n-i),Math.floor(o)!==Math.floor(n)&&t?.(),o=n)},remaining(){return n},max:e}}const ae="/assets/tick-DjoKiDek.wav",ce="/assets/move-BLADOFfx.wav",fe="/assets/bump-CTm1GYxP.wav",de="/assets/win-BlkSuvmJ.wav",g={};let C=.4;function B(e,t){const n=new Audio(t);n.volume=C,g[e]=n}function ue(){B("tick",ae),B("move",ce),B("bump",fe),B("win",de)}function E(e){g[e]&&(g[e].load(),g[e].currentTime=0,g[e].play().catch(t=>{console.error(`Failed to play sound: ${e}`,t)}))}function me(e){g[e]&&(g[e].pause(),g[e].currentTime=0)}function ye(e){C=e;for(const t in g)g[t].volume=C}const O=document.getElementById("app"),S=O.getContext("2d");S.imageSmoothingEnabled=!1;O.width=H;O.height=j;ue();const G=document.getElementById("main-menu"),ge=document.getElementById("play-btn"),Ae=document.getElementById("settings-btn"),pe=document.getElementById("exit-btn"),k=document.getElementById("settings-menu"),U=document.getElementById("movement-toggle-btn"),Ee=document.getElementById("volume-slider"),he=document.getElementById("volume-label"),xe=document.getElementById("back-btn"),z=document.getElementById("tutorial"),J=document.getElementById("game-info"),P=32,D=60,Se=5,ve=2;let M="autorun",y,p,m,N,Y,R=!1,v=1,d=P,T=D,c="MENU";const we=150;let V=0,A={dx:0,dy:0},r={dx:0,dy:0},b;function K(e,t=!1){t?(v++,d=Math.max(8,P-(v-1)*ve),T=Math.max(10,D-(v-1)*Se)):(v=1,d=P,T=D),N=e??Date.now().toString(),Y=new seedrandom(N);const n=Math.floor(H/d),s=Math.floor(j/d);y=te(n,s,Y),p=ie(y.start.x,y.start.y,d),c="RUNNING",m&&m.stop(),m=re(T,()=>E("tick")),R=!1,V=0,A={dx:0,dy:0},r={dx:0,dy:0},console.log("Game started, seed:",N,"Level:",v,"Tile Size:",d,"Time Limit:",T);const o=new URL(location);o.searchParams.set("seed",N),history.pushState({},"",o),b=performance.now()}ge.addEventListener("click",()=>{G.style.display="none",app.style.display="block",z.style.display="block",J.style.display="block";const e=new URLSearchParams(location.search);K(e.get("seed")),c==="RUNNING"&&requestAnimationFrame(X)});Ae.addEventListener("click",()=>{G.style.display="none",k.style.display="block"});pe.addEventListener("click",()=>{window.close()});U.addEventListener("click",()=>{M==="manual"?(M="autorun",U.textContent="Movement: Auto-run"):(M="manual",U.textContent="Movement: Manual")});Ee.addEventListener("input",e=>{const t=e.target.value;ye(t),he.textContent=`${Math.round(t*100)}%`});xe.addEventListener("click",()=>{k.style.display="none",G.style.display="block"});addEventListener("keydown",e=>{if(e.code==="KeyR"){Z();return}if(e.code==="KeyM"){Q();return}if(c==="WON"||c==="LOST"){e.code==="Enter"?(console.debug("restarting"),c==="WON"?K(null,!0):Z()):e.code==="KeyM"&&(console.debug("Returning to main menu"),Q());return}if(c==="RUNNING"){let t=0,n=0;(e.code==="ArrowUp"||e.code==="KeyW")&&(n=-1),(e.code==="ArrowDown"||e.code==="KeyS")&&(n=1),(e.code==="ArrowLeft"||e.code==="KeyA")&&(t=-1),(e.code==="ArrowRight"||e.code==="KeyD")&&(t=1),(t!==0||n!==0)&&(R||(m.start(),R=!0),M==="manual"?q(p,y,t,n,d)?E("move"):E("bump"):M==="autorun"&&(A={dx:t,dy:n},r.dx===0&&r.dy===0&&(r={...A})))}});function Ne(e,t){q(p,y,e,t,d)?E("move"):E("bump")}function X(e){b===void 0&&(b=e);const t=(e-b)/1e3;if(b=e,c==="RUNNING"){if(M==="autorun"&&(r.dx!==0||r.dy!==0)&&e-V>we){V=e;const{gx:o,gy:i}=p;let l={...r};F(y,o,i,A.dx,A.dy)&&(A.dx!==r.dx||A.dy!==r.dy)?l={...A}:F(y,o,i,r.dx,r.dy)||(l={dx:0,dy:0}),r={...l},r.dx!==0||r.dy!==0?Ne(r.dx,r.dy):E("bump")}const n=Math.floor(p.x/d),s=Math.floor(p.y/d);n===y.exit.x&&s===y.exit.y?(c="WON",E("win"),console.debug("playsfx win"),m.stop(),console.log("Game state: WON")):(m.update(t),m.remaining()<=0&&(c="LOST",m.stop(),console.log("Game state: LOST")))}c!=="MENU"&&(ne(S,y,d),se(S,p,d),ee(S,m.remaining()),J.innerText=`SEED=${N} LEVEL=${v}`),c==="WON"&&L(S,"YOU WIN — ENTER TO NEXT LEVEL | M FOR MENU"),c==="LOST"&&L(S,"TIME OUT — ENTER TO RESTART | M FOR MENU"),c!=="MENU"&&requestAnimationFrame(X)}function F(e,t,n,s,o){const i=t+s,l=n+o;return i>=0&&i<e.w&&l>=0&&l<e.h&&e.grid[l][i]!==1}function Z(e=!1){console.log("Restarting game");const t=e?N:Date.now().toString();K(t)}function Q(){G.style.display="block",k.style.display="none",app.style.display="none",z.style.display="none",J.style.display="none",R=!1,me("win"),O.style.display="none",c="MENU",m&&m.stop(),console.log("Returning to main menu")}

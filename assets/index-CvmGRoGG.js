(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))d(u);new MutationObserver(u=>{for(const l of u)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function r(u){const l={};return u.integrity&&(l.integrity=u.integrity),u.referrerPolicy&&(l.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?l.credentials="include":u.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(u){if(u.ep)return;u.ep=!0;const l=r(u);fetch(u.href,l)}})();function Pe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function De(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var s=t.default;if(typeof s=="function"){var r=function d(){var u=!1;try{u=this instanceof d}catch{}return u?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};r.prototype=s.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(d){var u=Object.getOwnPropertyDescriptor(t,d);Object.defineProperty(r,d,u.get?u:{enumerable:!0,get:function(){return t[d]}})}),r}var Q={exports:{}},Ue=Q.exports,ge;function qe(){return ge||(ge=1,(function(t){(function(s,r,d){function u(e){var o=this,a=c();o.next=function(){var n=2091639*o.s0+o.c*23283064365386963e-26;return o.s0=o.s1,o.s1=o.s2,o.s2=n-(o.c=n|0)},o.c=1,o.s0=a(" "),o.s1=a(" "),o.s2=a(" "),o.s0-=a(e),o.s0<0&&(o.s0+=1),o.s1-=a(e),o.s1<0&&(o.s1+=1),o.s2-=a(e),o.s2<0&&(o.s2+=1),a=null}function l(e,o){return o.c=e.c,o.s0=e.s0,o.s1=e.s1,o.s2=e.s2,o}function x(e,o){var a=new u(e),n=o&&o.state,i=a.next;return i.int32=function(){return a.next()*4294967296|0},i.double=function(){return i()+(i()*2097152|0)*11102230246251565e-32},i.quick=i,n&&(typeof n=="object"&&l(n,a),i.state=function(){return l(a,{})}),i}function c(){var e=4022871197,o=function(a){a=String(a);for(var n=0;n<a.length;n++){e+=a.charCodeAt(n);var i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=i*4294967296}return(e>>>0)*23283064365386963e-26};return o}r&&r.exports?r.exports=x:this.alea=x})(Ue,t)})(Q)),Q.exports}var _={exports:{}},je=_.exports,pe;function Ve(){return pe||(pe=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var n=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^n^n>>>8},c===(c|0)?e.x=c:o+=c;for(var a=0;a<o.length+64;a++)e.x^=o.charCodeAt(a)|0,e.next()}function l(c,e){return e.x=c.x,e.y=c.y,e.z=c.z,e.w=c.w,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xor128=x})(je,t)})(_)),_.exports}var H={exports:{}},ke=H.exports,ve;function Je(){return ve||(ve=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.next=function(){var n=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(n^n<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,c===(c|0)?e.x=c:o+=c;for(var a=0;a<o.length+64;a++)e.x^=o.charCodeAt(a)|0,a==o.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function l(c,e){return e.x=c.x,e.y=c.y,e.z=c.z,e.w=c.w,e.v=c.v,e.d=c.d,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xorwow=x})(ke,t)})(H)),H.exports}var $={exports:{}},Ke=$.exports,me;function Xe(){return me||(me=1,(function(t){(function(s,r,d){function u(c){var e=this;e.next=function(){var a=e.x,n=e.i,i,f;return i=a[n],i^=i>>>7,f=i^i<<24,i=a[n+1&7],f^=i^i>>>10,i=a[n+3&7],f^=i^i>>>3,i=a[n+4&7],f^=i^i<<7,i=a[n+7&7],i=i^i<<13,f^=i^i<<9,a[n]=f,e.i=n+1&7,f};function o(a,n){var i,f=[];if(n===(n|0))f[0]=n;else for(n=""+n,i=0;i<n.length;++i)f[i&7]=f[i&7]<<15^n.charCodeAt(i)+f[i+1&7]<<13;for(;f.length<8;)f.push(0);for(i=0;i<8&&f[i]===0;++i);for(i==8?f[7]=-1:f[i],a.x=f,a.i=0,i=256;i>0;--i)a.next()}o(e,c)}function l(c,e){return e.x=c.x.slice(),e.i=c.i,e}function x(c,e){c==null&&(c=+new Date);var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(a.x&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xorshift7=x})(Ke,t)})($)),$.exports}var ee={exports:{}},Le=ee.exports,he;function ze(){return he||(he=1,(function(t){(function(s,r,d){function u(c){var e=this;e.next=function(){var a=e.w,n=e.X,i=e.i,f,y;return e.w=a=a+1640531527|0,y=n[i+34&127],f=n[i=i+1&127],y^=y<<13,f^=f<<17,y^=y>>>15,f^=f>>>12,y=n[i]=y^f,e.i=i,y+(a^a>>>16)|0};function o(a,n){var i,f,y,S,G,O=[],X=128;for(n===(n|0)?(f=n,n=null):(n=n+"\0",f=0,X=Math.max(X,n.length)),y=0,S=-32;S<X;++S)n&&(f^=n.charCodeAt((S+32)%n.length)),S===0&&(G=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,S>=0&&(G=G+1640531527|0,i=O[S&127]^=f+G,y=i==0?y+1:0);for(y>=128&&(O[(n&&n.length||0)&127]=-1),y=127,S=512;S>0;--S)f=O[y+34&127],i=O[y=y+1&127],f^=f<<13,i^=i<<17,f^=f>>>15,i^=i>>>12,O[y]=f^i;a.w=G,a.X=O,a.i=y}o(e,c)}function l(c,e){return e.i=c.i,e.w=c.w,e.X=c.X.slice(),e}function x(c,e){c==null&&(c=+new Date);var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(a.X&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.xor4096=x})(Le,t)})(ee)),ee.exports}var te={exports:{}},We=te.exports,we;function Ye(){return we||(we=1,(function(t){(function(s,r,d){function u(c){var e=this,o="";e.next=function(){var n=e.b,i=e.c,f=e.d,y=e.a;return n=n<<25^n>>>7^i,i=i-f|0,f=f<<24^f>>>8^y,y=y-n|0,e.b=n=n<<20^n>>>12^i,e.c=i=i-f|0,e.d=f<<16^i>>>16^y,e.a=y-n|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,c===Math.floor(c)?(e.a=c/4294967296|0,e.b=c|0):o+=c;for(var a=0;a<o.length+20;a++)e.b^=o.charCodeAt(a)|0,e.next()}function l(c,e){return e.a=c.a,e.b=c.b,e.c=c.c,e.d=c.d,e}function x(c,e){var o=new u(c),a=e&&e.state,n=function(){return(o.next()>>>0)/4294967296};return n.double=function(){do var i=o.next()>>>11,f=(o.next()>>>0)/4294967296,y=(i+f)/(1<<21);while(y===0);return y},n.int32=o.next,n.quick=n,a&&(typeof a=="object"&&l(a,o),n.state=function(){return l(o,{})}),n}r&&r.exports?r.exports=x:this.tychei=x})(We,t)})(te)),te.exports}var ne={exports:{}};const Fe={},Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"})),Qe=De(Ze);var _e=ne.exports,Ae;function He(){return Ae||(Ae=1,(function(t){(function(s,r,d){var u=256,l=6,x=52,c="random",e=d.pow(u,l),o=d.pow(2,x),a=o*2,n=u-1,i;function f(g,p,w){var m=[];p=p==!0?{entropy:!0}:p||{};var v=O(G(p.entropy?[g,L(r)]:g??X(),3),m),E=new y(m),N=function(){for(var b=E.g(l),T=e,I=0;b<o;)b=(b+I)*u,T*=u,I=E.g(1);for(;b>=a;)b/=2,T/=2,I>>>=1;return(b+I)/T};return N.int32=function(){return E.g(4)|0},N.quick=function(){return E.g(4)/4294967296},N.double=N,O(L(E.S),r),(p.pass||w||function(b,T,I,P){return P&&(P.S&&S(P,E),b.state=function(){return S(E,{})}),I?(d[c]=b,T):b})(N,v,"global"in p?p.global:this==d,p.state)}function y(g){var p,w=g.length,m=this,v=0,E=m.i=m.j=0,N=m.S=[];for(w||(g=[w++]);v<u;)N[v]=v++;for(v=0;v<u;v++)N[v]=N[E=n&E+g[v%w]+(p=N[v])],N[E]=p;(m.g=function(b){for(var T,I=0,P=m.i,Y=m.j,z=m.S;b--;)T=z[P=n&P+1],I=I*u+z[n&(z[P]=z[Y=n&Y+T])+(z[Y]=T)];return m.i=P,m.j=Y,I})(u)}function S(g,p){return p.i=g.i,p.j=g.j,p.S=g.S.slice(),p}function G(g,p){var w=[],m=typeof g,v;if(p&&m=="object")for(v in g)try{w.push(G(g[v],p-1))}catch{}return w.length?w:m=="string"?g:g+"\0"}function O(g,p){for(var w=g+"",m,v=0;v<w.length;)p[n&v]=n&(m^=p[n&v]*19)+w.charCodeAt(v++);return L(p)}function X(){try{var g;return i&&(g=i.randomBytes)?g=g(u):(g=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(g)),L(g)}catch{var p=s.navigator,w=p&&p.plugins;return[+new Date,s,w,s.screen,L(r)]}}function L(g){return String.fromCharCode.apply(0,g)}if(O(d.random(),r),t.exports){t.exports=f;try{i=Qe}catch{}}else d["seed"+c]=f})(typeof self<"u"?self:_e,[],Math)})(ne)),ne.exports}var se,Se;function $e(){if(Se)return se;Se=1;var t=qe(),s=Ve(),r=Je(),d=Xe(),u=ze(),l=Ye(),x=He();return x.alea=t,x.xor128=s,x.xorwow=r,x.xorshift7=d,x.xor4096=u,x.tychei=l,se=x,se}var et=$e();const tt=Pe(et),Ie=1400,Be=1e3,k={floor:"#1a1a1a",wall:"#2f2f2f",start:"#22d3ee",exit:"#f59e0b",player:"#4ade80",hud:"#9ca3af"};function nt(t,s){const r=Math.ceil(s),d=String(Math.floor(r/60)).padStart(2,"0"),u=String(r%60).padStart(2,"0");t.fillStyle=r<=10?"#ff5252":k.hud,t.font="20px 'Press Start 2P'",t.fillText(`${d}:${u}`,12,24)}function Ee(t,s){t.save(),t.fillStyle="#000a",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="#fff",t.font="28px 'Press Start 2P'";const r=t.measureText(s).width;t.fillText(s,(t.canvas.width-r)/2,t.canvas.height/2),t.restore()}function rt(t,s,r){t%2===0&&(t-=1),s%2===0&&(s-=1),t=Math.max(11,t),s=Math.max(11,s);const d=Array.from({length:s},()=>Array(t).fill(1)),u={x:1,y:1};d[u.y][u.x]=0;const l=[];for(c(u.x,u.y);l.length;){const e=Math.floor(r()*l.length),{x:o,y:a}=l.splice(e,1)[0],n=be(o,a,t,s).filter(i=>d[i.y][i.x]===0);if(n.length){const i=n[Math.floor(r()*n.length)],f=Math.floor((o+i.x)/2),y=Math.floor((a+i.y)/2);d[y][f]=0,d[a][o]=0,c(o,a)}}const x={x:t-2,y:s-2};return d[x.y][x.x]=0,{grid:d,w:t,h:s,start:u,exit:x};function c(e,o){for(const a of be(e,o,t,s))d[a.y][a.x]===1&&!l.some(n=>n.x===a.x&&n.y===a.y)&&l.push({x:a.x,y:a.y})}}function ot(t,s,r){const{grid:d,w:u,h:l,start:x,exit:c}=s;t.fillStyle=k.floor,t.fillRect(0,0,u*r,l*r),t.strokeStyle="rgba(255, 255, 255, 0.26)",t.lineWidth=1;for(let e=0;e<l;e++)for(let o=0;o<u;o++)t.strokeRect(o*r,e*r,r,r);t.fillStyle=k.wall;for(let e=0;e<l;e++)for(let o=0;o<u;o++)d[e][o]===1&&t.fillRect(o*r,e*r,r,r);t.fillStyle=k.start,t.fillRect(x.x*r,x.y*r,r,r),t.fillStyle=k.exit,t.fillRect(c.x*r,c.y*r,r,r)}function be(t,s,r,d){const u=[];return t-2>0&&u.push({x:t-2,y:s}),t+2<r-1&&u.push({x:t+2,y:s}),s-2>0&&u.push({x:t,y:s-2}),s+2<d-1&&u.push({x:t,y:s+2}),u}const it="data:image/png;base64,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";function st(t,s,r){return{dir:1,gx:t,gy:s,x:t*r,y:s*r,size:r}}function Ce(t,s,r,d,u){const l=t.gx+r,x=t.gy+d;return r>0&&(t.dir=1),r<0&&(t.dir=-1),l>=0&&l<s.w&&x>=0&&x<s.h&&s.grid[x][l]!==1?(t.gx=l,t.gy=x,t.x=t.gx*u,t.y=t.gy*u,!0):!1}function at(t,s,r){const d=ut(),u=Math.round(s.x),l=Math.round(s.y);t.save(),t.translate(u+r/2,l+r/2),t.scale(s.dir,1),d&&d.complete?t.drawImage(d,-r/2,-r/2,r,r):(t.fillStyle=k.player,t.fillRect(-s.size/2,-s.size/2,s.size,s.size)),t.restore()}function ut(){if(!window._playerImg){const t=new Image;t.src=it,window._playerImg=t}return window._playerImg}function ct(t,s){let r=t,d=!1,u=t;return{start(){d=!0},stop(){d=!1},pause(){d=!1},resume(){d=!0},update(l){d&&(r=Math.max(0,r-l),Math.floor(u)!==Math.floor(r)&&s?.(),u=r)},remaining(){return r},max:t}}const ft="/maze-runner-git/assets/tick-DjoKiDek.wav",lt="/maze-runner-git/assets/move-BLADOFfx.wav",dt="/maze-runner-git/assets/bump-CTm1GYxP.wav",xt="/maze-runner-git/assets/win-BlkSuvmJ.wav",C={};let ue=.4;function F(t,s){const r=new Audio(s);r.volume=ue,C[t]=r}function yt(){F("tick",ft),F("move",lt),F("bump",dt),F("win",xt)}function q(t){C[t]&&(C[t].load(),C[t].currentTime=0,C[t].play().catch(s=>{console.error(`Failed to play sound: ${t}`,s)}))}function gt(t){C[t]&&(C[t].pause(),C[t].currentTime=0)}function pt(t){ue=t;for(const s in C)C[s].volume=ue}const oe=document.getElementById("app"),j=oe.getContext("2d");j.imageSmoothingEnabled=!1;oe.width=Ie;oe.height=Be;yt();const ie=document.getElementById("main-menu"),vt=document.getElementById("play-btn"),mt=document.getElementById("settings-btn"),ht=document.getElementById("exit-btn"),de=document.getElementById("settings-menu"),ae=document.getElementById("movement-toggle-btn"),wt=document.getElementById("volume-slider"),At=document.getElementById("volume-label"),St=document.getElementById("back-btn"),Te=document.getElementById("tutorial"),xe=document.getElementById("game-info"),ce=32,fe=60,Et=5,bt=2;let K="autorun",B,U,R,J,Me,re=!1,V=1,M=ce,Z=fe,A="MENU";const Mt=150;let le=0,D={dx:0,dy:0},h={dx:0,dy:0},W;function ye(t,s=!1){s?(V++,M=Math.max(8,ce-(V-1)*bt),Z=Math.max(10,fe-(V-1)*Et)):(V=1,M=ce,Z=fe),J=t??Date.now().toString(),Me=tt(J);const r=Math.floor(Ie/M),d=Math.floor(Be/M);B=rt(r,d,Me),U=st(B.start.x,B.start.y,M),A="RUNNING",R&&R.stop(),R=ct(Z,()=>q("tick")),re=!1,le=0,D={dx:0,dy:0},h={dx:0,dy:0},console.log("Game started, seed:",J,"Level:",V,"Tile Size:",M,"Time Limit:",Z);const u=new URL(location);u.searchParams.set("seed",J),history.pushState({},"",u),W=performance.now()}vt.addEventListener("click",()=>{ie.style.display="none",app.style.display="block",Te.style.display="block",xe.style.display="block";const t=new URLSearchParams(location.search);ye(t.get("seed")),A==="RUNNING"&&requestAnimationFrame(Ge)});mt.addEventListener("click",()=>{ie.style.display="none",de.style.display="block"});ht.addEventListener("click",()=>{window.close()});ae.addEventListener("click",()=>{K==="manual"?(K="autorun",ae.textContent="Movement: Auto-run"):(K="manual",ae.textContent="Movement: Manual")});wt.addEventListener("input",t=>{const s=t.target.value;pt(s),At.textContent=`${Math.round(s*100)}%`});St.addEventListener("click",()=>{de.style.display="none",ie.style.display="block"});addEventListener("keydown",t=>{if(t.code==="KeyR"){Re();return}if(t.code==="KeyM"){Oe();return}if(A==="WON"||A==="LOST"){t.code==="Enter"?(console.debug("restarting"),A==="WON"?ye(null,!0):Re()):t.code==="KeyM"&&(console.debug("Returning to main menu"),Oe());return}if(A==="RUNNING"){let s=0,r=0;(t.code==="ArrowUp"||t.code==="KeyW")&&(r=-1),(t.code==="ArrowDown"||t.code==="KeyS")&&(r=1),(t.code==="ArrowLeft"||t.code==="KeyA")&&(s=-1),(t.code==="ArrowRight"||t.code==="KeyD")&&(s=1),(s!==0||r!==0)&&(re||(R.start(),re=!0),K==="manual"?Ce(U,B,s,r,M)?q("move"):q("bump"):K==="autorun"&&(D={dx:s,dy:r},h.dx===0&&h.dy===0&&(h={...D})))}});function Nt(t,s){Ce(U,B,t,s,M)?q("move"):q("bump")}function Ge(t){W===void 0&&(W=t);const s=(t-W)/1e3;if(W=t,A==="RUNNING"){if(K==="autorun"&&(h.dx!==0||h.dy!==0)&&t-le>Mt){le=t;const{gx:u,gy:l}=U;let x={...h};Ne(B,u,l,D.dx,D.dy)&&(D.dx!==h.dx||D.dy!==h.dy)?x={...D}:Ne(B,u,l,h.dx,h.dy)||(x={dx:0,dy:0}),h={...x},h.dx!==0||h.dy!==0?Nt(h.dx,h.dy):q("bump")}const r=Math.floor(U.x/M),d=Math.floor(U.y/M);r===B.exit.x&&d===B.exit.y?(A="WON",q("win"),console.debug("playsfx win"),R.stop(),console.log("Game state: WON")):(R.update(s),R.remaining()<=0&&(A="LOST",R.stop(),console.log("Game state: LOST")))}A!=="MENU"&&(ot(j,B,M),at(j,U,M),nt(j,R.remaining()),xe.innerText=`SEED=${J} LEVEL=${V}`),A==="WON"&&Ee(j,"YOU WIN — ENTER TO NEXT LEVEL | M FOR MENU"),A==="LOST"&&Ee(j,"TIME OUT — ENTER TO RESTART | M FOR MENU"),A!=="MENU"&&requestAnimationFrame(Ge)}function Ne(t,s,r,d,u){const l=s+d,x=r+u;return l>=0&&l<t.w&&x>=0&&x<t.h&&t.grid[x][l]!==1}function Re(t=!1){console.log("Restarting game");const s=t?J:Date.now().toString();ye(s)}function Oe(){ie.style.display="block",de.style.display="none",app.style.display="none",Te.style.display="none",xe.style.display="none",re=!1,gt("win"),oe.style.display="none",A="MENU",R&&R.stop(),console.log("Returning to main menu")}
